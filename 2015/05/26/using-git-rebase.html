<!DOCTYPE html><html><head><title>dev.toihrk.me</title><link href="http://yui.yahooapis.com/pure/0.5.0/pure-min.css" rel="stylesheet" type="text/css"><link href="/layout.css" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png"><link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16"><link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-TileImage" content="/mstile-144x144.png"><link href="/github-markdown.css" rel="stylesheet" type="text/css"><link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/github.min.css" rel="stylesheet" type="text/css"><link href="/page.css" rel="stylesheet" type="text/css"><link href="/2015/05/26/using-git-rebase.html" rel="canonical"><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js" type="text/javascript"></script></head><body><header class="pure-u-1-1"><a href="/"><h1>dev.toihrk.me</h1></a></header><div id="articleContainer"><article><div class="publish-date"><time datetime="2015-05-26" pubdate><span class="date-year"><a href="/archives/2015.html">2015</a>/</span><span class="date-month"><a href="/archives/2015-05.html">05</a>/</span><span class="date-day">26</span></time></div><div class="markdown-body"><h1 id="-git-rebase-2015-05-26-using-git-rebase-html-"><a href="/2015/05/26/using-git-rebase.html">git rebaseを使う</a></h1>
<p>チーム開発をしていてGithub上でPRを送る際に</p>
<ul>
<li>レビューのしやすいPRを送る</li>
<li>意味のあるコミットを心がける</li>
</ul>
<p>という点を指摘された。</p>
<p>PRを出すときに、そのPRに関係のない差分とか作業上でコミットはしたが、コミットに(タイポを直しただけなど)意味が無く複数のコミットを1つのコミットにまとめたいときなどに「Gitには<code>rebase</code>という便利機能があるから使うと良い」みたいなアドバイスをもらった。</p>
<p>Gitはそこそこ使ってたつもりだったけど、<code>rebase</code>はあまり使ったことが無かったし、ちゃんと使い方を知ってどんどん使っていく。</p>
<p><code>rebase</code>は、コミット履歴がわかりやすくなる。</p>
<p><code>merge</code>すると以下のようになるコミット履歴が
<img src="https://git-scm.com/figures/18333fig0328-tn.png" alt="merge"></p>
<p><code>rebase</code>すると以下のようになる。
<img src="https://git-scm.com/figures/18333fig0329-tn.png" alt="rebase"></p>
<p>画像引用: <a href="https://git-scm.com/book/ja/v1/Git-%E3%81%AE%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E6%A9%9F%E8%83%BD-%E3%83%AA%E3%83%99%E3%83%BC%E3%82%B9">Git - リベース</a></p>
<h2 id="-pr-">レビューのしやすいPRを送る</h2>
<p>今の開発はdevelopブランチからどんどんブランチを切ってPRを送る感じなのだけれど、今回は分岐したブランチにdevelopブランチを<code>pull</code>したときのマージコミットがPRに含まれていてレビューのしにくいPRになってしまっていた。</p>
<p>今回、developブランチでは原則として作業をしないみたいな感じで、developブランチ上での<code>pull</code>でマージコミットを残さないべきで以下のようにする。</p>
<pre><code>$ git pull --rebase
</code></pre><p>今回のようにdevelopブランチでは常に<code>pull --rebase</code>するときは以下のように設定すると間違えて<code>pull</code>したときでも<code>pull --rebase</code>される。</p>
<pre><code>$ git config branch.develop.rebase true
</code></pre><p>常に<code>pull --rebase</code>するときは以下の用に設定すると<code>~/.gitconfig</code>に以下の記述が入る。</p>
<pre><code>$ git config --global pull.rebase preserve
$ cat ~/.gitconfig
[pull]
    rebase = preserve
</code></pre><h2 id="-">意味のあるコミットを心がける</h2>
<p>typoを修正しただけのコミットは無意味で、可能であれば対象のファイルを変更したコミットにtypoを修正したコミットを含めるべきだ。</p>
<p>コミットメッセージにも気をつかい、そのコミットがなんのためのコミットか、どのような変更をしたかということを記述する。</p>
<p>このようなことを考えると、今までのコミットを修正したくなってくる。
<code>git rebase -i</code>を使う。</p>
<pre><code>$ git rebase -i HEAD~~
</code></pre><p>テキストエディタが起動しHEADからHEAD~~までのコミットが以下の様に表示される。</p>
<pre><code>pick 31cd74a Add README.md
pick 77bda38 typo README

# Rebase bca98b5..77bda38 onto bca98b5 (2 command(s))
#
# Commands:
# p, pick = use commit
# r, reword = use commit, but edit the commit message
# e, edit = use commit, but stop for amending
# s, squash = use commit, but meld into previous commit
# f, fixup = like &quot;squash&quot;, but discard this commit&#39;s log message
# x, exec = run command (the rest of the line) using shell
#
# These lines can be re-ordered; they are executed from top to bottom.
#
# If you remove a line here THAT COMMIT WILL BE LOST.
#
# However, if you remove everything, the rebase will be aborted.
#
# Note that empty commits are commented out
</code></pre><p>試しに、<code>77bda38 typo README</code>というコミットのコミットメッセージを<code>typo README.md</code>に変更してみる。</p>
<pre><code>e 77bda38 typo README
</code></pre><p>と変更し、エディタを終了する。</p>
<pre><code>Stopped at 77bda38be1de80bd37e456b647295581742dc899... typo README
You can amend the commit now, with

    git commit --amend

Once you are satisfied with your changes, run

    git rebase --continue
</code></pre><p>と表示されるので従うとコミットメッセージが修正される。
再度、<code>rebase -i</code>を実行する。</p>
<pre><code>pick 31cd74a Add README.md
pick c209f7d typo README.md
</code></pre><p>やはりtypoを修正したコミットは無意味でREADME.mdを追加したコミットに含めたいとき<code>squash</code>を使う。</p>
<pre><code>s c209f7d typo README.md
</code></pre><p>と変更し、エディタを終了する。
エディタが再び起動しコミットメッセージを編集する。
エディタを終了するとコミットが1つになっている。</p>
<pre><code>$ git log
commit 54b156a11a7385f3593f48ad580a2107c3c8c4f6
Author: toihrk &lt;toihrk@me.com&gt;
Date:   Thu May 28 19:23:02 2015 +0900

    Add README.md

    typo README.md

commit bca98b59c2692ae68b07cf5724778c62d8f56e5c
Author: toihrk &lt;toihrk@me.com&gt;
Date:   Thu May 28 19:21:31 2015 +0900

    Initial commit
</code></pre><p>こんな調子になるので、コミットの履歴が綺麗になり、自然にPRもレビューのしやすいものになる。</p>
<p>参考 : <a href="https://git-scm.com/book/ja/v1/Git-%E3%81%AE%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E6%A9%9F%E8%83%BD-%E3%83%AA%E3%83%99%E3%83%BC%E3%82%B9">Git - リベース</a></p>
</div><div class="btns"><a id="issue" href="https://github.com/toihrk-me/dev-blog/issues" data-icon="octicon-issue-opened" data-style="mega" data-count-api="/repos/toihrk-me/dev-blog#open_issues_count" data-count-aria-label="# issues on GitHub" aria-label="Issue toihrk-me/dev-blog on GitHub" class="github-button">Issue</a></div><script src="/page.js" type="text/javascript"></script></article></div><footer class="pure-u-1-1"><ul><li><a href="https://github.com/toihrk-me/dev-blog" data-icon="octicon-eye" data-count-href="/toihrk-me/dev-blog/watchers" data-count-api="/repos/toihrk-me/dev-blog#subscribers_count" data-count-aria-label="# watchers on GitHub" aria-label="Watch toihrk-me/dev-blog on GitHub" class="github-button">Watch</a></li><li><a href="https://github.com/toihrk-me/dev-blog" data-icon="octicon-star" data-count-href="/toihrk-me/dev-blog/stargazers" data-count-api="/repos/toihrk-me/dev-blog#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star toihrk-me/dev-blog on GitHub" class="github-button">Star</a></li><li><a href="https://github.com/toihrk" aria-label="Follow @toihrk on GitHub" class="github-button">Follow @toihrk</a></li></ul><ul><li><a href="/archives" class="button">Archives</a></li><li><a href="http://toihrk.me" class="button">About me</a></li><li><span id="copyright">&copy; 2015 toihrk. All rights reserved.</span></li></ul><script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script></footer></body></html>